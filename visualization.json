{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": { "url": "building_inventory_data.csv" },
  "transform": [
    {
      "aggregate": [
        {
          "op": "count",
          "as": "count"
        }
      ],
      "groupby": ["Agency Name"]
    },
    {
      "window": [
        {
          "op": "rank",
          "as": "rank"
        }
      ],
      "sort": [
        {
          "field": "count",
          "order": "descending"
        }
      ]
    },
    {
      "filter": "datum.rank <= 5"
    },
    {
      "joinaggregate": [
        {
          "op": "sum",
          "field": "Square Footage",
          "as": "totalSquareFootage"
        }
      ],
      "groupby": ["Agency Name", "Year Acquired"]
    }
  ],
  "mark": "line",
  "encoding": {
    "x": {
      "field": "Year Acquired",
      "type": "temporal",
      "title": "Year Acquired"
    },
    "y": {
      "field": "totalSquareFootage",
      "type": "quantitative",
      "title": "Square Footage"
    },
    "color": {
      "field": "Agency Name",
      "type": "nominal"
    }
  }
}
